@page "/vipps-redirect"
@rendermode InteractiveServer
@using Microsoft.AspNetCore.Components.Web
@inject NavigationManager NavigationManager

<div class="vippsfake">
    <p>Redirecting to Vipps... (@countdown seconds)</p>
</div>

@code {
    private int countdown = 10;
    private CancellationTokenSource? cts;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            cts = new CancellationTokenSource();
            await StartCountdownAsync();
        }
    }

    private async Task StartCountdownAsync()
    {
        try
        {
            while (countdown > 0 && !cts!.Token.IsCancellationRequested)
            {
                await Task.Delay(1000, cts.Token);
                countdown--;
                await InvokeAsync(StateHasChanged);
            }

            if (countdown <= 0 && !cts.Token.IsCancellationRequested)
            {
                NavigationManager.NavigateTo("/claimed-codes", forceLoad: true);
            }
        }
        catch (TaskCanceledException)
        {
            // Expected when component is disposed
        }
    }

    public void Dispose()
    {
        cts?.Cancel();
        cts?.Dispose();
    }
}

<style>
    .vippsfake {
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 100vh;
        background: #000;
        @* background-color: #ff6f00; *@
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 2rem;
        color: white;
        font-weight: bold;
    }
</style>